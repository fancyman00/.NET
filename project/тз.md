# Техническое задание: Система управления наймом "RecruitFlow"

## 1. Обзор проекта

### 1.1. Назначение
Корпоративная система для автоматизации процессов найма сотрудников с микросервисной архитектурой.

### 1.2. Архитектура
- **Main Service** - основная бизнес-логика
- **Auth Service** - аутентификация и авторизация  
- **File Service** - управление файлами через MinIO
- **Blazor Frontend** - веб-интерфейс

## 2. Технологический стек

- **Backend:** ASP.NET Core Web API
- **Frontend:** Blazor Server
- **Архитектура:** Clean Architecture
- **Базы данных:** PostgreSQL
- **Кэширование:** In-memory cache (Redis / .NET)
- **Файловое хранилище:** MinIO
- **Коммуникация:** gRPC + HTTP API
- **Контейнеризация:** Docker Compose

## 3. Сервисы

### 3.1. Auth Service
**Функциональность:**
- Регистрация и аутентификация пользователей
- Управление ролями и правами доступа
- JWT токены и refresh tokens
- Восстановление пароля

**gRPC Services:**

**AuthenticationService:**
- `Register(RegisterRequest) returns (RegisterResponse)`
- `Login(LoginRequest) returns (LoginResponse)`
- `RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse)`
- `ForgotPassword(ForgotPasswordRequest) returns (ForgotPasswordResponse)`
- `ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse)`

**ValidateTokenService:**
- `ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse)`
- `GetUserInfo(GetUserInfoRequest) returns (GetUserInfoResponse)`
- `GetUserRoles(GetUserRolesRequest) returns (GetUserRolesResponse)`

**UserManagementService:**
- `GetUsers(GetUsersRequest) returns (GetUsersResponse)`
- `UpdateUser(UpdateUserRequest) returns (UpdateUserResponse)`
- `DeleteUser(DeleteUserRequest) returns (DeleteUserResponse)`

**RoleManagementService:**
- `GetRoles(GetRolesRequest) returns (GetRolesResponse)`
- `CreateRole(CreateRoleRequest) returns (CreateRoleResponse)`
- `UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse)`
- `DeleteRole(DeleteRoleRequest) returns (DeleteRoleResponse)`
- `AssignRoleToUser(AssignRoleRequest) returns (AssignRoleResponse)`
- `RemoveRoleFromUser(RemoveRoleRequest) returns (RemoveRoleResponse)`

**PermissionManagementService:**
- `GetPermissions(GetPermissionsRequest) returns (GetPermissionsResponse)`
- `GetUserPermissions(GetUserPermissionsRequest) returns (GetUserPermissionsResponse)`
- `CheckPermission(CheckPermissionRequest) returns (CheckPermissionResponse)`
- `AssignPermissionToRole(AssignPermissionRequest) returns (AssignPermissionResponse)`
- `RemovePermissionFromRole(RemovePermissionRequest) returns (RemovePermissionResponse)`

**Сущности:**
- **Users** - пользователи (Id, Email, PasswordHash, FirstName, LastName, CreatedAt, IsActive)
- **Roles** - роли (Id, Name, Description, IsSystem, CreatedAt, CreatedBy)
- **UserRoles** - связь пользователей и ролей (UserId, RoleId, AssignedAt, AssignedBy)
- **Permissions** - функции доступа (Id, Name, Description, Category, CreatedAt)
- **RolePermissions** - связь ролей и функций (RoleId, PermissionId, GrantedAt, GrantedBy)
- **RefreshTokens** - токены обновления (Id, UserId, Token, ExpiresAt, CreatedAt)
- **PasswordResetTokens** - токены сброса пароля (Id, UserId, Token, ExpiresAt, CreatedAt)
- **LoginHistory** - история входов (Id, UserId, LoginAt, IpAddress, UserAgent)

### 3.1.1. Система ролей и прав доступа

#### Функциональная модель ролей

Система использует функциональную модель, где права доступа определяются набором функций (permissions), а не фиксированными ролями. Администратор может создавать кастомные роли, назначая им необходимый набор функций.

#### Предустановленные роли

**1. Системный администратор**
- Полный доступ ко всем функциям системы
- Управление пользователями и ролями
- Настройка системы
- Создание и редактирование кастомных ролей

**2. Пользователь по умолчанию**
- Базовая роль для новых пользователей
- Минимальный набор функций для работы в системе

#### Система функций (Permissions)

**Управление пользователями:**
- `users.view` - Просмотр списка пользователей
- `users.create` - Создание новых пользователей
- `users.edit` - Редактирование пользователей
- `users.delete` - Удаление пользователей
- `users.manage_roles` - Назначение ролей пользователям

**Управление ролями:**
- `roles.view` - Просмотр ролей
- `roles.create` - Создание кастомных ролей
- `roles.edit` - Редактирование ролей
- `roles.delete` - Удаление ролей
- `roles.assign_permissions` - Назначение функций ролям

**Управление вакансиями:**
- `positions.view` - Просмотр вакансий
- `positions.create` - Создание вакансий
- `positions.edit` - Редактирование вакансий
- `positions.delete` - Удаление вакансий
- `positions.close` - Закрытие вакансий
- `positions.view_all` - Просмотр всех вакансий (включая чужие)
- `positions.edit_all` - Редактирование всех вакансий

**Управление кандидатами:**
- `candidates.view` - Просмотр кандидатов
- `candidates.create` - Создание кандидатов
- `candidates.edit` - Редактирование кандидатов
- `candidates.delete` - Удаление кандидатов
- `candidates.view_all` - Просмотр всех кандидатов
- `candidates.edit_all` - Редактирование всех кандидатов
- `candidates.apply` - Подача заявок на вакансии

**Управление собеседованиями:**
- `interviews.view` - Просмотр собеседований
- `interviews.create` - Создание собеседований
- `interviews.edit` - Редактирование собеседований
- `interviews.delete` - Отмена собеседований
- `interviews.conduct` - Проведение собеседований
- `interviews.rate` - Оценка кандидатов
- `interviews.view_all` - Просмотр всех собеседований

**Управление файлами:**
- `files.upload` - Загрузка файлов
- `files.download` - Скачивание файлов
- `files.delete` - Удаление файлов
- `files.view_all` - Просмотр всех файлов

**Отчеты и аналитика:**
- `reports.view` - Просмотр отчетов
- `reports.export` - Экспорт отчетов
- `reports.advanced` - Расширенная аналитика

**Настройки системы:**
- `settings.view` - Просмотр настроек
- `settings.edit` - Редактирование настроек
- `settings.manage_stages` - Управление этапами собеседований

**Уведомления:**
- `notifications.view` - Просмотр уведомлений
- `notifications.send` - Отправка уведомлений

#### Примеры кастомных ролей

**HR-менеджер:**
- `positions.view_all`, `positions.create`, `positions.edit_all`
- `candidates.view_all`, `candidates.create`, `candidates.edit_all`
- `interviews.view_all`, `interviews.create`, `interviews.edit`, `interviews.conduct`
- `reports.view`, `reports.export`
- `files.upload`, `files.download`

**Рекрутер:**
- `positions.view`, `positions.create`, `positions.edit` (только свои)
- `candidates.view`, `candidates.create`, `candidates.edit`
- `interviews.view`, `interviews.create`, `interviews.edit`, `interviews.conduct`
- `files.upload`, `files.download`

**Интервьюер:**
- `candidates.view` (только по собеседованиям)
- `interviews.view`, `interviews.conduct`, `interviews.rate`
- `files.download`

**Наблюдатель:**
- `positions.view`
- `candidates.view`
- `interviews.view`
- `reports.view`

### 3.2. File Service
**Функциональность:**
- Загрузка файлов в MinIO
- Генерация предварительно подписанных URL
- Управление правами доступа к файлам
- Валидация типов и размеров файлов

**API Endpoints:**
- `POST /api/files/upload` - загрузка файла
- `GET /api/files/{fileId}` - информация о файле
- `GET /api/files/{fileId}/download` - URL для скачивания
- `DELETE /api/files/{fileId}` - удаление файла
- `GET /api/files` - список файлов

**Сущности:**
- **Files** - метаданные файлов (Id, FileName, FilePath, FileSize, ContentType, UploadedAt, UploadedBy)
- **FileAccessRights** - права доступа (Id, FileId, UserId, CanRead, CanWrite, CanDelete)
- **FileDownloadHistory** - история скачиваний (Id, FileId, UserId, DownloadedAt, IpAddress)
- **Buckets** - управление корзинами MinIO (Id, BucketName, CreatedAt, IsActive)

### 3.3. Main Service
**Функциональность:**
- Управление вакансиями и кандидатами
- Процессы найма и собеседований
- Интеграция с Auth и File сервисами

**API Endpoints:**

**Positions (Вакансии):**
- `GET /api/positions` - список вакансий
- `GET /api/positions/{id}` - получение вакансии
- `POST /api/positions` - создание вакансии
- `PUT /api/positions/{id}` - обновление вакансии
- `DELETE /api/positions/{id}` - удаление вакансии
- `GET /api/positions/{id}/candidates` - кандидаты по вакансии
- `POST /api/positions/{id}/close` - закрытие вакансии

**Candidates (Кандидаты):**
- `GET /api/candidates` - список кандидатов
- `GET /api/candidates/{id}` - получение кандидата
- `POST /api/candidates` - создание кандидата
- `PUT /api/candidates/{id}` - обновление кандидата
- `DELETE /api/candidates/{id}` - удаление кандидата
- `GET /api/candidates/{id}/positions` - вакансии кандидата
- `POST /api/candidates/{id}/apply` - подача заявки на вакансию
- `GET /api/candidates/search` - поиск кандидатов

**Interviews (Собеседования):**
- `GET /api/interviews` - список собеседований
- `GET /api/interviews/{id}` - получение собеседования
- `POST /api/interviews` - создание собеседования
- `PUT /api/interviews/{id}` - обновление собеседования
- `DELETE /api/interviews/{id}` - отмена собеседования
- `POST /api/interviews/{id}/complete` - завершение собеседования
- `GET /api/interviews/upcoming` - предстоящие собеседования

**Interview Stages (Этапы собеседований):**
- `GET /api/stages` - список этапов
- `GET /api/stages/{id}` - получение этапа
- `POST /api/stages` - создание этапа
- `PUT /api/stages/{id}` - обновление этапа
- `DELETE /api/stages/{id}` - удаление этапа
- `PUT /api/stages/reorder` - изменение порядка этапов

**Resumes (Резюме):**
- `GET /api/resumes` - список резюме
- `GET /api/resumes/{id}` - получение резюме
- `POST /api/resumes` - загрузка резюме
- `DELETE /api/resumes/{id}` - удаление резюме
- `GET /api/resumes/{id}/download` - скачивание резюме
- `POST /api/resumes/{id}/set-primary` - установка основного резюме

**Comments (Комментарии):**
- `GET /api/comments` - список комментариев
- `POST /api/comments` - создание комментария
- `PUT /api/comments/{id}` - обновление комментария
- `DELETE /api/comments/{id}` - удаление комментария

**Notifications (Уведомления):**
- `GET /api/notifications` - список уведомлений
- `PUT /api/notifications/{id}/read` - отметка как прочитанное
- `PUT /api/notifications/read-all` - отметить все как прочитанные
- `GET /api/notifications/unread-count` - количество непрочитанных

**Reports (Отчеты):**
- `GET /api/reports/hiring-metrics` - метрики найма
- `GET /api/reports/position-statistics` - статистика по вакансиям
- `GET /api/reports/candidate-pipeline` - воронка кандидатов
- `GET /api/reports/interview-performance` - эффективность собеседований

**Сущности:**
- **Positions** - вакансии (Id, Title, Description, Requirements, Department, Salary, EmploymentType, Status, CreatedAt, CreatedBy)
- **Candidates** - кандидаты (Id, FirstName, LastName, Email, Phone, Experience, Skills, Status, CreatedAt, CreatedBy)
- **CandidatePositions** - связь кандидатов и вакансий (Id, CandidateId, PositionId, AppliedAt, Status, Notes)
- **InterviewStages** - этапы собеседований (Id, Name, Description, Order, IsActive, CreatedAt)
- **Interviews** - собеседования (Id, CandidateId, PositionId, InterviewerId, StageId, ScheduledAt, Status, Notes, Rating)
- **Resumes** - резюме (Id, CandidateId, FileId, IsPrimary, UploadedAt, UploadedBy)
- **Comments** - комментарии (Id, EntityType, EntityId, UserId, Content, CreatedAt, IsDeleted)
- **Notifications** - уведомления (Id, UserId, Title, Message, Type, IsRead, CreatedAt)

## 4. Пользовательский интерфейс

### Основные страницы

#### 4.1. Вход в систему
- Форма входа (email, пароль)
- Восстановление пароля
- Регистрация новых пользователей

#### 4.2. Главная панель
- Статистика по вакансиям и кандидатам
- Календарь предстоящих собеседований
- Быстрые действия (создать вакансию, добавить кандидата)

#### 4.3. Вакансии
- Список вакансий с фильтрами и поиском
- Создание и редактирование вакансий
- Просмотр кандидатов по вакансии

#### 4.4. Кандидаты
- Список кандидатов
- Профиль кандидата с резюме
- История собеседований и комментарии

#### 4.5. Собеседования
- Календарь собеседований
- Планирование встреч
- Проведение собеседований с оценками

#### 4.6. Отчеты
- Статистика по найму
- Воронка кандидатов
- Экспорт в Excel/PDF

#### 4.7. Настройки
- Управление пользователями
- Настройка этапов собеседований
- Конфигурация системы

#### 4.8. Управление ролями и правами
- Список ролей с возможностью создания, редактирования и удаления
- Создание кастомных ролей с выбором функций доступа
- Назначение ролей пользователям
- Просмотр и управление функциями доступа
- Матрица прав доступа для визуального контроля

#### 4.9. Управление пользователями
- Список пользователей с фильтрами и поиском
- Создание и редактирование профилей пользователей
- Назначение и снятие ролей
- Активация/деактивация пользователей
- История действий пользователей 