# Техническое задание: Система управления наймом "RecruitFlow"

## 1. Обзор проекта

### 1.1. Назначение
Корпоративная система для автоматизации процессов найма сотрудников с микросервисной архитектурой.

### 1.2. Архитектура
- **Main Service** - основная бизнес-логика
- **Auth Service** - аутентификация и авторизация  
- **File Service** - управление файлами через MinIO
- **Blazor Frontend** - веб-интерфейс

## 2. Технологический стек

- **Backend:** ASP.NET Core Web API
- **Frontend:** Blazor Server
- **Архитектура:** Clean Architecture
- **Базы данных:** PostgreSQL
- **Кэширование:** In-memory cache (Redis / .NET)
- **Файловое хранилище:** MinIO
- **Коммуникация:** gRPC + HTTP API
- **Контейнеризация:** Docker Compose

## 3. Сервисы

### 3.1. Auth Service
**Функциональность:**
- Регистрация и аутентификация пользователей
- Управление ролями и правами доступа
- JWT токены и refresh tokens
- Восстановление пароля

**gRPC Services:**

**AuthenticationService:**
- `Register(RegisterRequest) returns (RegisterResponse)`
- `Login(LoginRequest) returns (LoginResponse)`
- `RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse)`
- `ForgotPassword(ForgotPasswordRequest) returns (ForgotPasswordResponse)`
- `ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse)`

**ValidateTokenService:**
- `ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse)`
- `GetUserInfo(GetUserInfoRequest) returns (GetUserInfoResponse)`
- `GetUserRoles(GetUserRolesRequest) returns (GetUserRolesResponse)`

**UserManagementService:**
- `GetUsers(GetUsersRequest) returns (GetUsersResponse)`
- `UpdateUser(UpdateUserRequest) returns (UpdateUserResponse)`
- `DeleteUser(DeleteUserRequest) returns (DeleteUserResponse)`

**Сущности:**
- **Users** - пользователи (Id, Email, PasswordHash, FirstName, LastName, CreatedAt, IsActive)
- **Roles** - роли (Id, Name, Description, CreatedAt)
- **UserRoles** - связь пользователей и ролей (UserId, RoleId)
- **Claims** - права доступа (Id, Name, Description)
- **RefreshTokens** - токены обновления (Id, UserId, Token, ExpiresAt, CreatedAt)
- **PasswordResetTokens** - токены сброса пароля (Id, UserId, Token, ExpiresAt, CreatedAt)
- **LoginHistory** - история входов (Id, UserId, LoginAt, IpAddress, UserAgent)

### 3.1.1. Система ролей и прав доступа

#### Роли пользователей

**1. Администратор**
- Полный доступ ко всем функциям
- Управление пользователями и настройками

**2. HR-менеджер** 
- Управление вакансиями и кандидатами
- Планирование собеседований
- Просмотр отчетов

**3. Рекрутер**
- Создание вакансий в своем отделе
- Работа с кандидатами по своим вакансиям
- Планирование собеседований

**4. Интервьюер**
- Просмотр информации о кандидатах
- Проведение собеседований
- Добавление оценок

**5. Наблюдатель**
- Только просмотр информации
- Просмотр отчетов

#### Основные права доступа

| Функция | Админ | HR | Рекрутер | Интервьюер | Наблюдатель |
|---------|-------|----|---------|-----------|-----------| 
| Управление пользователями | ✅ | ❌ | ❌ | ❌ | ❌ |
| Создание вакансий | ✅ | ✅ | ✅ | ❌ | ❌ |
| Редактирование вакансий | ✅ | ✅ | Только свои | ❌ | ❌ |
| Создание кандидатов | ✅ | ✅ | ✅ | ❌ | ❌ |
| Просмотр кандидатов | ✅ | ✅ | Только по своим вакансиям | Только по собеседованиям | ❌ |
| Проведение собеседований | ✅ | ✅ | ✅ | ✅ | ❌ |
| Просмотр отчетов | ✅ | ✅ | ✅ | ❌ | ✅ |
| Настройки системы | ✅ | ❌ | ❌ | ❌ | ❌ |

### 3.2. File Service
**Функциональность:**
- Загрузка файлов в MinIO
- Генерация предварительно подписанных URL
- Управление правами доступа к файлам
- Валидация типов и размеров файлов

**API Endpoints:**
- `POST /api/files/upload` - загрузка файла
- `GET /api/files/{fileId}` - информация о файле
- `GET /api/files/{fileId}/download` - URL для скачивания
- `DELETE /api/files/{fileId}` - удаление файла
- `GET /api/files` - список файлов

**Сущности:**
- **Files** - метаданные файлов (Id, FileName, FilePath, FileSize, ContentType, UploadedAt, UploadedBy)
- **FileAccessRights** - права доступа (Id, FileId, UserId, CanRead, CanWrite, CanDelete)
- **FileDownloadHistory** - история скачиваний (Id, FileId, UserId, DownloadedAt, IpAddress)
- **Buckets** - управление корзинами MinIO (Id, BucketName, CreatedAt, IsActive)

### 3.3. Main Service
**Функциональность:**
- Управление вакансиями и кандидатами
- Процессы найма и собеседований
- Интеграция с Auth и File сервисами

**API Endpoints:**

**Positions (Вакансии):**
- `GET /api/positions` - список вакансий
- `GET /api/positions/{id}` - получение вакансии
- `POST /api/positions` - создание вакансии
- `PUT /api/positions/{id}` - обновление вакансии
- `DELETE /api/positions/{id}` - удаление вакансии
- `GET /api/positions/{id}/candidates` - кандидаты по вакансии
- `POST /api/positions/{id}/close` - закрытие вакансии

**Candidates (Кандидаты):**
- `GET /api/candidates` - список кандидатов
- `GET /api/candidates/{id}` - получение кандидата
- `POST /api/candidates` - создание кандидата
- `PUT /api/candidates/{id}` - обновление кандидата
- `DELETE /api/candidates/{id}` - удаление кандидата
- `GET /api/candidates/{id}/positions` - вакансии кандидата
- `POST /api/candidates/{id}/apply` - подача заявки на вакансию
- `GET /api/candidates/search` - поиск кандидатов

**Interviews (Собеседования):**
- `GET /api/interviews` - список собеседований
- `GET /api/interviews/{id}` - получение собеседования
- `POST /api/interviews` - создание собеседования
- `PUT /api/interviews/{id}` - обновление собеседования
- `DELETE /api/interviews/{id}` - отмена собеседования
- `POST /api/interviews/{id}/complete` - завершение собеседования
- `GET /api/interviews/upcoming` - предстоящие собеседования

**Interview Stages (Этапы собеседований):**
- `GET /api/stages` - список этапов
- `GET /api/stages/{id}` - получение этапа
- `POST /api/stages` - создание этапа
- `PUT /api/stages/{id}` - обновление этапа
- `DELETE /api/stages/{id}` - удаление этапа
- `PUT /api/stages/reorder` - изменение порядка этапов

**Resumes (Резюме):**
- `GET /api/resumes` - список резюме
- `GET /api/resumes/{id}` - получение резюме
- `POST /api/resumes` - загрузка резюме
- `DELETE /api/resumes/{id}` - удаление резюме
- `GET /api/resumes/{id}/download` - скачивание резюме
- `POST /api/resumes/{id}/set-primary` - установка основного резюме

**Comments (Комментарии):**
- `GET /api/comments` - список комментариев
- `POST /api/comments` - создание комментария
- `PUT /api/comments/{id}` - обновление комментария
- `DELETE /api/comments/{id}` - удаление комментария

**Notifications (Уведомления):**
- `GET /api/notifications` - список уведомлений
- `PUT /api/notifications/{id}/read` - отметка как прочитанное
- `PUT /api/notifications/read-all` - отметить все как прочитанные
- `GET /api/notifications/unread-count` - количество непрочитанных

**Reports (Отчеты):**
- `GET /api/reports/hiring-metrics` - метрики найма
- `GET /api/reports/position-statistics` - статистика по вакансиям
- `GET /api/reports/candidate-pipeline` - воронка кандидатов
- `GET /api/reports/interview-performance` - эффективность собеседований

**Сущности:**
- **Positions** - вакансии (Id, Title, Description, Requirements, Department, Salary, EmploymentType, Status, CreatedAt, CreatedBy)
- **Candidates** - кандидаты (Id, FirstName, LastName, Email, Phone, Experience, Skills, Status, CreatedAt, CreatedBy)
- **CandidatePositions** - связь кандидатов и вакансий (Id, CandidateId, PositionId, AppliedAt, Status, Notes)
- **InterviewStages** - этапы собеседований (Id, Name, Description, Order, IsActive, CreatedAt)
- **Interviews** - собеседования (Id, CandidateId, PositionId, InterviewerId, StageId, ScheduledAt, Status, Notes, Rating)
- **Resumes** - резюме (Id, CandidateId, FileId, IsPrimary, UploadedAt, UploadedBy)
- **Comments** - комментарии (Id, EntityType, EntityId, UserId, Content, CreatedAt, IsDeleted)
- **Notifications** - уведомления (Id, UserId, Title, Message, Type, IsRead, CreatedAt)

## 4. Пользовательский интерфейс

### Основные страницы

#### 4.1. Вход в систему
- Форма входа (email, пароль)
- Восстановление пароля
- Регистрация новых пользователей

#### 4.2. Главная панель
- Статистика по вакансиям и кандидатам
- Календарь предстоящих собеседований
- Быстрые действия (создать вакансию, добавить кандидата)

#### 4.3. Вакансии
- Список вакансий с фильтрами и поиском
- Создание и редактирование вакансий
- Просмотр кандидатов по вакансии

#### 4.4. Кандидаты
- Список кандидатов
- Профиль кандидата с резюме
- История собеседований и комментарии

#### 4.5. Собеседования
- Календарь собеседований
- Планирование встреч
- Проведение собеседований с оценками

#### 4.6. Отчеты
- Статистика по найму
- Воронка кандидатов
- Экспорт в Excel/PDF

#### 4.7. Настройки
- Управление пользователями
- Настройка этапов собеседований
- Конфигурация системы